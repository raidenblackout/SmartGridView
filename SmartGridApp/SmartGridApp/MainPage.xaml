<Page x:Class="SmartGridApp.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:SmartGridApp"
      xmlns:controls="using:SmartGrid.Controls"
      xmlns:viewmodels="using:SmartGridApp"
      Background="White"
      NavigationCacheMode="Required">

    <Page.Resources>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>
    </Page.Resources>

   <Grid Background="#F3F3F3">
      <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
          <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- Navigation Header -->
      <Grid Grid.Row="0" Background="White" Padding="20,12" BorderBrush="#EEEEEE" BorderThickness="0,0,0,1">
          <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>
          <StackPanel Orientation="Horizontal" Spacing="12">
              <Viewbox Height="24">
                  <SymbolIcon Symbol="AllApps"/>
              </Viewbox>
              <TextBlock Text="SmartGrid Dashboard" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
          </StackPanel>
          <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
              <Button Content="Navigate to Second Page" Click="OnNavigateClicked" Background="#007ACC" Foreground="White" CornerRadius="4" Padding="12,6"/>
              <Button Content="Test ListView" Click="OnTestListViewClicked" Background="#28a745" Foreground="White" CornerRadius="4" Padding="12,6"/>
          </StackPanel>
      </Grid>

      <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
          <controls:SmartGridView x:Name="GridControl" 
                                  ItemsSource="{x:Bind ViewModel.Cards}" 
                                  Background="Transparent"
                                  Padding="10">
              <controls:SmartGridView.ItemTemplate>
                 <DataTemplate x:DataType="viewmodels:CardViewModel">
                         <Grid Margin="6" x:Name="RootGrid" Background="White" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="8"
                               PointerPressed="OnCardSelected">
                            
                             <VisualStateManager.VisualStateGroups>
                                 <VisualStateGroup x:Name="SelectionStates">
                                     <VisualState x:Name="Normal">
                                         <VisualState.StateTriggers>
                                             <StateTrigger IsActive="{x:Bind IsSelected, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"/>
                                         </VisualState.StateTriggers>
                                     </VisualState>
                                     <VisualState x:Name="Selected">
                                         <VisualState.StateTriggers>
                                             <StateTrigger IsActive="{x:Bind IsSelected, Mode=OneWay}"/>
                                         </VisualState.StateTriggers>
                                         <VisualState.Setters>
                                             <Setter Target="RootGrid.BorderBrush" Value="#007ACC"/>
                                             <Setter Target="RootGrid.BorderThickness" Value="2"/>
                                             <Setter Target="SelectionOverlay.Visibility" Value="Visible"/>
                                         </VisualState.Setters>
                                     </VisualState>
                                 </VisualStateGroup>
                                 
                                 <VisualStateGroup x:Name="ExpansionStates">
                                     <VisualState x:Name="CollapsedState">
                                         <VisualState.StateTriggers>
                                             <StateTrigger IsActive="{x:Bind IsExpanded, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"/>
                                         </VisualState.StateTriggers>
                                         <VisualState.Setters>
                                             <Setter Target="CollapsedContent.Visibility" Value="Visible"/>
                                             <Setter Target="ExpandedContent.Visibility" Value="Collapsed"/>
                                         </VisualState.Setters>
                                     </VisualState>
                                     <VisualState x:Name="ExpandedState">
                                         <VisualState.StateTriggers>
                                             <StateTrigger IsActive="{x:Bind IsExpanded, Mode=OneWay}"/>
                                         </VisualState.StateTriggers>
                                         <VisualState.Setters>
                                             <Setter Target="CollapsedContent.Visibility" Value="Collapsed"/>
                                             <Setter Target="ExpandedContent.Visibility" Value="Visible"/>
                                             <!-- Change the root style for the expanded card -->
                                             <Setter Target="RootGrid.Background" Value="#1E1E1E"/>
                                             <Setter Target="RootGrid.BorderBrush" Value="#333333"/>
                                         </VisualState.Setters>
                                     </VisualState>
                                 </VisualStateGroup>
                             </VisualStateManager.VisualStateGroups>

                             <!-- COLLAPSED DESIGN (Original) -->
                             <Grid x:Name="CollapsedContent">
                                 <Grid.RowDefinitions>
                                     <RowDefinition Height="*"/>
                                     <RowDefinition Height="Auto"/>
                                 </Grid.RowDefinitions>

                                 <!-- Top Section: Image Content -->
                                 <Border Grid.Row="0" Background="#EEEEEE" CornerRadius="8,8,0,0">
                                     <Grid>
                                         <Image Source="{x:Bind ImageUrl1}" Stretch="UniformToFill"/>
                                         <Border Background="#99000000" VerticalAlignment="Bottom" Height="36" Padding="12,0">
                                             <TextBlock Text="{x:Bind Title}" Foreground="White" VerticalAlignment="Center" FontWeight="Bold"/>
                                         </Border>
                                         <Ellipse Width="44" Height="44" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="10" Stroke="White" StrokeThickness="2">
                                             <Ellipse.Fill>
                                                 <ImageBrush ImageSource="{x:Bind ImageUrl2}" Stretch="UniformToFill"/>
                                             </Ellipse.Fill>
                                         </Ellipse>
                                     </Grid>
                                 </Border>

                                 <!-- Bottom Section: Info and Expand -->
                                 <Grid Grid.Row="1" Padding="12" Background="White" CornerRadius="0,0,8,8">
                                     <StackPanel Spacing="2">
                                         <TextBlock Text="{x:Bind Title}" FontSize="9" Opacity="0.4" TextTrimming="CharacterEllipsis"/>
                                         <TextBlock Text="{x:Bind DisplayIndex}" FontSize="18" FontWeight="Black" Foreground="#333333"/>
                                     </StackPanel>

                                     <!-- EXPAND BUTTON -->
                                     <Border Background="#E53935" CornerRadius="4" Padding="12,6" 
                                             HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                             PointerPressed="OnExpandClicked">
                                         <TextBlock Text="EXPAND" Foreground="White" FontSize="11" FontWeight="Black"/>
                                     </Border>
                                 </Grid>
                             </Grid>

                             <!-- EXPANDED DESIGN (New, Bigger, Premium) -->
                             <Grid x:Name="ExpandedContent" Visibility="Collapsed">
                                 <Grid.ColumnDefinitions>
                                     <ColumnDefinition Width="2*"/>
                                     <ColumnDefinition Width="3*"/>
                                 </Grid.ColumnDefinitions>

                                 <!-- Hero Image on Left -->
                                 <Image Grid.Column="0" Source="{x:Bind ImageUrl1}" Stretch="UniformToFill" VerticalAlignment="Stretch"/>
                                 
                                 <!-- Content on Right -->
                                 <Grid Grid.Column="1" Padding="24">
                                     <StackPanel Spacing="12">
                                         <Border Background="#33FFFFFF" HorizontalAlignment="Left" CornerRadius="4" Padding="8,4">
                                              <TextBlock Text="PREMIUM SELECTION" Foreground="#00E5FF" FontSize="10" FontWeight="Bold" CharacterSpacing="100"/>
                                         </Border>
                                         
                                         <TextBlock Text="{x:Bind Title}" FontSize="32" FontWeight="Bold" Foreground="White" TextWrapping="Wrap"/>
                                         
                                         <TextBlock Text="This is the expanded view showing rich details about the donut. The layout has completely changed to a horizontal split design." 
                                                    Foreground="#AAAAAA" FontSize="14" TextWrapping="Wrap" MaxLines="3"/>
                                         
                                         <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
                                              <Grid Width="40" Height="40" CornerRadius="20" Background="#333">
                                                  <SymbolIcon Symbol="Favorite" Foreground="#E53935"/>
                                              </Grid>
                                              <Grid Width="40" Height="40" CornerRadius="20" Background="#333">
                                                  <SymbolIcon Symbol="Share" Foreground="White"/>
                                              </Grid>
                                         </StackPanel>
                                     </StackPanel>

                                     <!-- COLLAPSE BUTTON -->
                                     <Border Background="#444444" CornerRadius="4" Padding="16,8" 
                                             HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                             PointerPressed="OnExpandClicked">
                                         <StackPanel Orientation="Horizontal" Spacing="8">
                                             <SymbolIcon Symbol="Back" Foreground="White"/>
                                             <TextBlock Text="COLLAPSE" Foreground="White" FontSize="12" FontWeight="Bold"/>
                                         </StackPanel>
                                     </Border>
                                 </Grid>
                             </Grid>

                             <!-- Selection Indicator Overlay -->
                             <Border x:Name="SelectionOverlay" Visibility="Collapsed" Background="#22007ACC" IsHitTestVisible="False"/>
                         </Grid>
                 </DataTemplate>
              </controls:SmartGridView.ItemTemplate>
          </controls:SmartGridView>
      </ScrollViewer>

      <!-- Interactive Debug Bar (High Contrast Dark Theme) -->
      <Border Grid.Row="2" Background="#1E1E1E" BorderBrush="#007ACC" BorderThickness="0,2,0,0" Padding="16,10">
          <Grid>
              <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto"/>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="Auto"/>
              </Grid.ColumnDefinitions>

              <StackPanel Orientation="Horizontal" Spacing="24">
                  <StackPanel Orientation="Horizontal" Spacing="12">
                      <TextBlock Text="Total Cards:" VerticalAlignment="Center" Foreground="#AAAAAA" FontSize="12"/>
                      <Slider Value="{x:Bind ViewModel.CardCount, Mode=TwoWay}" Minimum="0" Maximum="5000" Width="180" VerticalAlignment="Center"/>
                      <TextBlock Text="{x:Bind ViewModel.CardCount, Mode=OneWay}" VerticalAlignment="Center" Foreground="White" FontWeight="Bold" Width="45"/>
                  </StackPanel>
              </StackPanel>

              <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="28">
                  <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="Visible:" Foreground="#888888" FontSize="11" VerticalAlignment="Center"/>
                      <TextBlock Text="{x:Bind GridControl.VisibleItemsCount, Mode=OneWay}" Foreground="#00E5FF" FontWeight="Bold" FontSize="14"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="Range:" Foreground="#888888" FontSize="11" VerticalAlignment="Center"/>
                      <TextBlock Text="{x:Bind GridControl.VisibleRangeStart, Mode=OneWay}" Foreground="White" FontWeight="Bold" FontSize="13"/>
                      <TextBlock Text="→" Foreground="#444444"/>
                      <TextBlock Text="{x:Bind GridControl.VisibleRangeEnd, Mode=OneWay}" Foreground="White" FontWeight="Bold" FontSize="13"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="Layout (Cur/Avg/Max):" Foreground="#888888" FontSize="11" VerticalAlignment="Center"/>
                      <TextBlock Text="{x:Bind GridControl.LayoutDuration, Mode=OneWay}" Foreground="#00E5FF" FontWeight="Bold" FontSize="12"/>
                      <TextBlock Text="/" Foreground="#444444" FontSize="11"/>
                      <TextBlock Text="{x:Bind GridControl.AvgLayoutDuration, Mode=OneWay}" Foreground="#AAAAAA" FontSize="11"/>
                      <TextBlock Text="/" Foreground="#444444" FontSize="11"/>
                      <TextBlock Text="{x:Bind GridControl.MaxLayoutDuration, Mode=OneWay}" Foreground="#FF5555" FontSize="11"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="Arrange (Cur/Avg/Max):" Foreground="#888888" FontSize="11" VerticalAlignment="Center"/>
                      <TextBlock Text="{x:Bind GridControl.ArrangeDuration, Mode=OneWay}" Foreground="#00E5FF" FontWeight="Bold" FontSize="12"/>
                      <TextBlock Text="/" Foreground="#444444" FontSize="11"/>
                      <TextBlock Text="{x:Bind GridControl.AvgArrangeDuration, Mode=OneWay}" Foreground="#AAAAAA" FontSize="11"/>
                      <TextBlock Text="/" Foreground="#444444" FontSize="11"/>
                      <TextBlock Text="{x:Bind GridControl.MaxArrangeDuration, Mode=OneWay}" Foreground="#FF5555" FontSize="11"/>
                  </StackPanel>
                  <StackPanel Orientation="Horizontal" Spacing="6">
                      <TextBlock Text="Viewport:" Foreground="#888888" FontSize="11" VerticalAlignment="Center"/>
                      <TextBlock Text="{x:Bind GridControl.ViewportRectString, Mode=OneWay}" Foreground="#AAAAAA" FontSize="11" VerticalAlignment="Center"/>
                  </StackPanel>
                  
                  <Button Content="Reset" Click="OnResetMetricsClicked" Padding="8,4" FontSize="11" Background="#333333" Foreground="White" BorderThickness="0" CornerRadius="4" VerticalAlignment="Center"/>
              </StackPanel>
          </Grid>
      </Border>
   </Grid>
</Page>
